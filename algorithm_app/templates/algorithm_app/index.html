<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Anime.js with Django</title>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
</head>
<body>
    <canvas id="canvas" width="800" height="600" style="border:1px solid #000000;"></canvas>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const points = JSON.parse('{{ points|safe }}');
            function fetchAndUpdate() {
            fetch('{% url "new-coordinates" %}')
                .then(response => response.json())
                .then(data => {
                    console.log("Fetch points")
                    console.log(data)
                    drawPoints(data.points);
                })
                .catch(error => console.error('Error fetching new coordinates:', error));
        }

            function drawPoints(points) {
                console.log("New Points...")
                console.log(points[0])
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                points.forEach(point => {
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, point.size, 0, 2 * Math.PI, false);
                    ctx.fillStyle = 'black';
                    ctx.fill();
                });
            }

            drawPoints(points);

            anime({
                targets: points,
                x: function() { return anime.random(0, canvas.width); },
                y: function() { return anime.random(0, canvas.height); },
                size: function() { return anime.random(5, 20); },
                easing: 'linear',
                duration: 500,
                update: drawPoints,
                loop: true
            });
            setInterval(fetchAndUpdate, 100);

        });

    </script>
</body>
</html>
